<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>̰����</title>
    <script>
        var map; //��ͼ�����
        var snake; //�������
        var food; //ʳ�������
        var timer; //��ʱ������
        var sum = 0; //����

        //��ͼ��
        function Map() {
            this.width = 800; //��ͼ����
            this.height = 400; //��ͼ�߶�
            this.position = 'absolute'; //��λ��ʽ
            this.color = '#cccccc'; //��ͼ��ɫ
            this._map = null; //�����ͼdomԪ��

            this.show = function () {
                //������ʾ��ͼ
                //������ͼdivԪ��
                this._map = document.createElement('div');
                //���õ�ͼ��ʽ
                this._map.style.width = this.width + 'px';
                this._map.style.height = this.height + 'px';
                this._map.style.position = this.position;
                this._map.style.backgroundColor = this.color;

                //����ͼdivԪ��׷�ӵ�body��ǩ֮��
                document.getElementsByTagName('body')[0].appendChild(this._map);
            };
        }

        //ʳ����
        function Food() {
            this.width = 20; //����
            this.height = 20; //�߶�
            this.position = 'absolute'; //��λ��ʽ
            this.color = '#00ff00'; //ʳ����ɫ
            this._food = null; //���ڱ���ʳ��domԪ��
            this.x = 0; //����ڼ�����
            this.y = 0; //����ڼ�����

            this.show = function () {
                //������ʾʳ��
                if (this._food == null) {
                    this._food = document.createElement('div');

                    //����ʳ����ʽ
                    this._food.style.width = this.width + 'px';
                    this._food.style.height = this.height + 'px';
                    this._food.style.position = this.position;
                    this._food.style.backgroundColor = this.color;

                    map._map.appendChild(this._food);
                }
                //���֮ǰ��������ֻ��Ҫ������������
                this.x = Math.floor(Math.random() * 40);
                this.y = Math.floor(Math.random() * 20);
                this._food.style.left = this.x * this.width + 'px';
                this._food.style.top = this.y * this.height + 'px';
            };
        }

        //����
        function Snake() {
            this.width = 20; //�߽ڿ���
            this.height = 20; //�߽ڸ߶�
            this.position = 'absolute'; //�߽ڶ�λ��ʽ
            this.direct = ''; //�ߵ��ƶ�����
            //�����߽�ȫ����Ϣ
            this.body = [
                [3, 2, 'red', null],
                [2, 2, 'blue', null],
                [1, 2, 'blue', null]
            ];

            this.setDirect = function (code) {
                switch (code) {
                    case 37:
                        //if (this.direct != 'right')
                        this.direct = 'left';
                        break;
                    case 38:
                        if (this.direct != 'down') {
                            this.direct = 'up';
                        }
                        break;
                    case 39:
                        if (this.direct != 'left') {
                            this.direct = 'right';
                        }
                        break;
                    case 40:
                        if (this.direct != 'up') {
                            this.direct = 'down';
                        }
                        break;
                }
            }

            this.show = function () {
                //������ʾ��
                for (var i = 0; i < this.body.length; i++) {
                    if (this.body[i][3] == null) {
                        this.body[i][3] = document.createElement('div');
                        this.body[i][3].style.width = this.width + 'px';
                        this.body[i][3].style.height = this.height + 'px';
                        this.body[i][3].style.position = this.position;
                        this.body[i][3].style.backgroundColor = this.body[i][2];
                        map._map.appendChild(this.body[i][3]);
                    }
                    this.body[i][3].style.backgroundColor = this.body[i][2];
                    //�����߽ڵĺ�������
                    this.body[i][3].style.left = this.body[i][0] * this.width + 'px';
                    this.body[i][3].style.top = this.body[i][1] * this.height + 'px';
                }
            }

            this.move = function () {
                //�ƶ�����
                var length = this.body.length - 1;
                for (var i = length; i > 0; i--) {
                    //�ú�����߽ڵ��������ǰ���߽ڵ�����
                    this.body[i][0] = this.body[i - 1][0]; //������
                    this.body[i][1] = this.body[i - 1][1]; //������

                }
                switch (this.direct) {
                    case 'right':
                        this.body[0][0] = this.body[0][0] + 1;
                        this.body[0][2] = 'black';
                        break;
                    case 'down':
                        this.body[0][1] = this.body[0][1] + 1;
                        this.body[0][2] = 'pink';
                        break;
                    case 'left':
                        this.body[0][0] = this.body[0][0] - 1;
                        this.body[0][2] = 'yellowgreen';
                        break;
                    case 'up':
                        this.body[0][1] = this.body[0][1] - 1;
                        this.body[0][2] = 'red';
                        break;
                    default:
                        return;
                }

                //�ж��߳Ե�ʳ��
                if (this.body[0][0] == food.x && this.body[0][1] == food.y) {
                    var x = this.body[length][0];
                    var y = this.body[length][1];
                    sum++;
                    document.title = '����:' + sum + '��';
                    this.body.push([x, y, 'blue', null]);
                    food.show();
                }

                //�ж�ײǽ��
                if (this.body[0][0] < 0 || this.body[0][0] > 39 || this.body[0][1] < 0 || this.body[0][1] > 19) {
                    //alert('ײǽ��');
                    //clearTimeout(timer);
                    //return;
                    if (this.body[0][0] > 39)
                        this.body[0][0] = 0;
                    if (this.body[0][0] < 0 )
                        this.body[0][0] = 39;
                    if (this.body[0][1] > 19)
                        this.body[0][1] = 0;
                    if (this.body[0][1] < 0)
                        this.body[0][1] = 19;

                }

                // //�Ե��Լ���
                // for (var i = 1; i < this.body.length; i++) {
                //     if (this.body[0][0] == this.body[i][0] && this.body[0][1] == this.body[i][1]) {
                //         alert('�Ե��Լ���');
                //         clearTimeout(timer);
                //         return;
                //     }
                // }
                this.show();
            }
        }

        window.onload = function () {
            map = new Map(); //ʵ������ͼ�����
            map.show(); //��ʾ��ͼ


            food = new Food(); //ʵ����ʳ�������
            food.show(); //��ʾʳ��

            snake = new Snake(); //ʵ�����������
            snake.show();
            timer = setInterval('snake.move()', 50);

            document.onkeydown = function () {
                var code;
                if (window.event) {
                    code = window.event.keyCode;
                } else {
                    code = event.keyCode;
                }
                snake.setDirect(code);
            };


        }
    </script>
</head>

<body>

</body>

</html>